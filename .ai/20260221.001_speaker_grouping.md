# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º

**–î–∞—Ç–∞:** 2026-02-21  
**–§–∞–π–ª:** `transcribe/t_gigaam.py`

## üéØ –ó–∞–¥–∞—á–∞

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Å–ø–∏–∫–µ—Ä–∞ –≤ –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —Ç–µ–∫—Å—Ç–∞. –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å–ø–∏–∫–µ—Ä–∞ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤—ã–π –±–ª–æ–∫.

## ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `group_by_speaker()`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ "–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º"

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

1. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** –±–ª–æ–∫–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∞–≤–∏–ª–∞–º:
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–∏–Ω –±–ª–æ–∫
   - –ü—Ä–∏ —Å–º–µ–Ω–µ —Å–ø–∏–∫–µ—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –±–ª–æ–∫
   - –ü—Ä–∏ –ø–∞—É–∑–µ ‚â• `MIN_PAUSE_SEC` (60 —Å–µ–∫) —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –±–ª–æ–∫ –¥–∞–∂–µ –¥–ª—è —Ç–æ–≥–æ –∂–µ —Å–ø–∏–∫–µ—Ä–∞

3. **–û—Ü–µ–Ω–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** 
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞: `–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚âà –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ª–æ–≤ / 150 * 60` —Å–µ–∫—É–Ω–¥
   - –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–∞—É–∑—ã –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

```python
for block in sorted_blocks:
    pause = block.start_sec - last_end
    
    should_create_new = (
        current_speaker is not None and 
        (block.speaker != current_speaker or pause >= MIN_PAUSE_SEC)
    )
    
    if should_create_new:
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫
        grouped.append(TextBlock(...))
        # –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π
    
    current_texts.append(block.text)
```

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –ë—ã–ª–æ (–¥–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏):
```
[00:00:04] SPEAKER_00: –†–∞—Å–ø–∏—Å–∞.
[00:00:10] SPEAKER_00: –ß—Ç–æ–± –≤—ã –ø–æ–Ω–∏–º–∞–ª–∏, –Ω–∞—à—É –∑—É–±–Ω—É—é —Ñ–æ—Ä–º—É–ª—É.
[00:00:14] SPEAKER_00: –í–µ—Ä—Ö–Ω—è—è —á–µ–ª—é—Å—Ç—å —É –Ω–∞—Å...
[00:00:16] SPEAKER_00: –ò –Ω–∏–∂–Ω—è—è —á–µ–ª—é—Å—Ç—å. –í–µ—Ä—Ö–Ω—è—è –ø—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî —ç—Ç–æ —Å–µ–≥–º–µ–Ω—Ç –ø–µ—Ä–≤—ã–π.
[00:00:26] SPEAKER_01: –í—Ç–æ—Ä–æ–π —Å–µ–≥–º–µ–Ω—Ç.
[00:00:27] SPEAKER_00: –ù–∏–∂–Ω—è—è —Ç—Ä–µ—Ç—å ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç —Ç—Ä–µ—Ç–∏–π.
```

### –°—Ç–∞–ª–æ (–ø–æ—Å–ª–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏):
```
[00:00:04] SPEAKER_00: –†–∞—Å–ø–∏—Å–∞. –ß—Ç–æ–± –≤—ã –ø–æ–Ω–∏–º–∞–ª–∏, –Ω–∞—à—É –∑—É–±–Ω—É—é —Ñ–æ—Ä–º—É–ª—É. –í–µ—Ä—Ö–Ω—è—è —á–µ–ª—é—Å—Ç—å —É –Ω–∞—Å... –ò –Ω–∏–∂–Ω—è—è —á–µ–ª—é—Å—Ç—å. –í–µ—Ä—Ö–Ω—è—è –ø—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî —ç—Ç–æ —Å–µ–≥–º–µ–Ω—Ç –ø–µ—Ä–≤—ã–π.

[00:00:26] SPEAKER_01: –í—Ç–æ—Ä–æ–π —Å–µ–≥–º–µ–Ω—Ç.

[00:00:27] SPEAKER_00: –ù–∏–∂–Ω—è—è —Ç—Ä–µ—Ç—å ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç —Ç—Ä–µ—Ç–∏–π.
```

## üîß –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:

```python
logger.info(f"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ {len(all_blocks)} –±–ª–æ–∫–æ–≤ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º...")
logger.debug(f"–°–æ–∑–¥–∞–Ω –±–ª–æ–∫: [{timestamp}] {speaker}, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {count}, —Å–∏–º–≤–æ–ª–æ–≤: {length}")
logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ {len(grouped_blocks)} —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤")
```

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `group_by_speaker()`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä:** `List[TextBlock]` - —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- **–í–æ–∑–≤—Ä–∞—Ç:** `List[TextBlock]` - —Å–ø–∏—Å–æ–∫ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
- **–õ–æ–≥–∏–∫–∞:** –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `transcribe_with_speakers()`
- –£–±—Ä–∞–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–∞—É–∑–∞–º
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `group_by_speaker()`
- –£–ø—Ä–æ—â–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

## üé® –£–ª—É—á—à–µ–Ω–∏—è

1. ‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –¢–µ–∫—Å—Ç –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –º–µ–ª–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã
2. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è–º–∏ —Ä–∞–∑–Ω—ã—Ö —Å–ø–∏–∫–µ—Ä–æ–≤
3. ‚úÖ **–ü–∞—É–∑—ã:** –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –±–æ–ª—å—à–∏–µ –ø–∞—É–∑—ã (‚â•60 —Å–µ–∫) –¥–∞–∂–µ —É –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞
4. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (—É—Ä–æ–≤–µ–Ω—å DEBUG)

## üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `MIN_PAUSE_SEC = 60` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –¥–ª—è —Ä–∞–∑—Ä—ã–≤–∞ –±–ª–æ–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞
- `MAX_BLOCK_DURATION_SEC = 300` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∞ (—Ä–µ–∑–µ—Ä–≤ –Ω–∞ –±—É–¥—É—â–µ–µ)
- `MIN_SEGMENT_DURATION_SEC = 0.8` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

